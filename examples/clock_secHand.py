import serial
import time
import datetime
import pymobitec_flipdot as flipdot


clock_face = [[0, 1], [0, 0], [1, 0], [7, 0], [13, 0], [14, 0], [20, 0], [26, 0], [27, 0],
              [0, 14], [0, 15], [1, 15], [7, 15], [13, 15], [14, 15], [20, 15], [26, 15], [27, 15],
              [27, 1], [27, 7], [27, 8], [27, 14], [0, 7], [0, 8]]


second_hand = {
    0: [[15, 0]],
    1: [[16, 0]],
    2: [[17, 0]],
    3: [[18, 0]],
    4: [[19, 0]],

    5: [[21, 0]],
    6: [[22, 0]],
    7: [[23, 0]],
    8: [[24, 0]],
    9: [[25, 0]],

    10: [[27, 2]],
    11: [[27, 3]],
    12: [[27, 4]],
    13: [[27, 5]],
    14: [[27, 6]],

    15: [[27, 9]],
    16: [[27, 10]],
    17: [[27, 11]],
    18: [[27, 12]],
    19: [[27, 13]],

    20: [[25, 15]],
    21: [[24, 15]],
    22: [[23, 15]],
    23: [[22, 15]],
    24: [[21, 15]],

    25: [[19, 15]],
    26: [[18, 15]],
    27: [[17, 15]],
    28: [[16, 15]],
    29: [[15, 15]],

    30: [[12, 15]],
    31: [[11, 15]],
    32: [[10, 15]],
    33: [[9, 15]],
    34: [[8, 15]],

    35: [[6, 15]],
    36: [[5, 15]],
    37: [[4, 15]],
    38: [[3, 15]],
    39: [[2, 15]],

    40: [[0, 13]],
    41: [[0, 12]],
    42: [[0, 11]],
    43: [[0, 10]],
    44: [[0, 9]],

    45: [[0, 6]],
    46: [[0, 5]],
    47: [[0, 4]],
    48: [[0, 3]],
    49: [[0, 2]],

    50: [[2, 0]],
    51: [[3, 0]],
    52: [[4, 0]],
    53: [[5, 0]],
    54: [[6, 0]],

    55: [[8, 0]],
    56: [[9, 0]],
    57: [[10, 0]],
    58: [[11, 0]],
    59: [[12, 0]]
}


with serial.Serial('/dev/ttyS0', 4800, timeout=1) as ser:
    while True:
        currentTime = datetime.datetime.now()

        test = clock_face.copy()
        test.extend(second_hand[currentTime.second])

        time_now = datetime.datetime.now()
        time_str = time_now.strftime("%H:%M")
        msg = flipdot.set_text_and_pixels(time_str, 4, 12, flipdot.Fonts.text_9px, tuple(zip(*test)))
        ser.write(msg)
        time.sleep(0.9)

